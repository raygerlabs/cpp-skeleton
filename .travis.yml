language: cpp

matrix:
  include:
    - os: linux
      arch: amd64
      dist: focal
    - os: linux
      arch: ppc64le
      dist: focal
    - os: linux
      arch: s390x
      dist: focal
    - os: linux
      arch: arm64  
      dist: focal
    - os: linux
      arch: amd64
      dist: jammy
    - os: linux
      arch: ppc64le
      dist: jammy
    - os: linux
      arch: s390x
      dist: jammy
    - os: linux
      arch: arm64  
      dist: jammy
    - os: osx
      osx_image: xcode14.2

addons:
  apt:
    packages:
      - ccache
      - python3
      - python3-pip

  homebrew:
    packages:
      - ccache
      - python3

env:
  global:
    - CONAN_V2_MODE=1
    - CONAN_REVISIONS_ENABLED=1
    - CONAN_SCM_TO_CONANDATA=1

cache:
  - directories:
    - $HOME/.cache/pip
    - $HOME/.ccache
    - $HOME/.conan2
    - $HOME/Library/Caches/Homebrew

install:
  - pip3 install cmake ninja conan --upgrade
  - conan profile detect -f

before_script:
  - cd imagelib

script:
  - conan install . -s build_type=Release -b missing
  - cmake --workflow --fresh --preset ci
